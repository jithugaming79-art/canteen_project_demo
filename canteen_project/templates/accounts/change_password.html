{% extends 'base.html' %}

{% block title %}Change Password - CampusBites{% endblock %}

{% block navbar %}{% endblock %}
{% block footer %}{% endblock %}

{% block content %}
<div class="auth-body">
    <div class="auth-container">
        <!-- Visual Side (Left) -->
        <div class="auth-visual" style="background: linear-gradient(135deg, #10b981 0%, #059669 100%);">
            <div class="quote-container animate-enter delay-2">
                <div class="quote-text">Stay<br>secure.</div>
                <div class="quote-sub">Update your password to keep your account safe.</div>
            </div>
        </div>

        <!-- Content Side (Right) -->
        <div class="auth-content">
            <a href="{% url 'home' %}" class="brand-title">üçî CampusBites</a>

            <div class="animate-enter delay-1">
                <h2 class="page-title">Change Password</h2>
                <p class="page-subtitle">Enter your old password and choose a new one.</p>
            </div>

            <form method="POST" class="animate-enter delay-2">
                {% csrf_token %}

                {% if form.non_field_errors %}
                <div
                    style="background: #fef2f2; color: #ef4444; padding: 12px; border-radius: 8px; margin-bottom: 20px; font-size: 14px; border: 1px solid #fca5a5;">
                    {{ form.non_field_errors.0 }}
                </div>
                {% endif %}

                <div class="form-group-modern">
                    <label class="modern-label">Current Password</label>
                    <input type="password" name="old_password" class="modern-input" required>
                    {% if form.old_password.errors %}
                    <span style="color: #ef4444; font-size: 12px; margin-top: 4px; display: block;">{{
                        form.old_password.errors.0 }}</span>
                    {% endif %}
                </div>

                <div class="form-group-modern">
                    <label class="modern-label">New Password</label>
                    <input type="password" name="new_password1" id="new_password" class="modern-input" required>
                    {% if form.new_password1.errors %}
                    <span style="color: #ef4444; font-size: 12px; margin-top: 4px; display: block;">{{
                        form.new_password1.errors.0 }}</span>
                    {% endif %}

                    <div class="password-meter-container" style="margin-top: 8px;">
                        <div class="password-meter"
                            style="display: flex; gap: 4px; height: 4px; border-radius: 2px; overflow: hidden; background: #e5e7eb;">
                            <div id="meter-segment-1"
                                style="flex: 1; background: transparent; transition: all 0.3s ease;"></div>
                            <div id="meter-segment-2"
                                style="flex: 1; background: transparent; transition: all 0.3s ease;"></div>
                            <div id="meter-segment-3"
                                style="flex: 1; background: transparent; transition: all 0.3s ease;"></div>
                            <div id="meter-segment-4"
                                style="flex: 1; background: transparent; transition: all 0.3s ease;"></div>
                        </div>
                        <div id="password-feedback"
                            style="font-size: 11px; margin-top: 4px; color: #6b7280; font-weight: 500;"></div>
                    </div>
                </div>

                <div class="form-group-modern">
                    <label class="modern-label">Confirm New Password</label>
                    <input type="password" name="new_password2" class="modern-input" required>
                    {% if form.new_password2.errors %}
                    <span style="color: #ef4444; font-size: 12px; margin-top: 4px; display: block;">{{
                        form.new_password2.errors.0 }}</span>
                    {% endif %}
                </div>

                <button type="submit" class="btn-ultra" style="margin-top: 12px;">Update Password</button>
            </form>

            <div class="animate-enter delay-3" style="text-align: center; margin-top: 32px;">
                <p style="color: #6b7280; font-size: 14px;">
                    Changed your mind?
                    <a href="{% url 'home' %}"
                        style="color: #111827; font-weight: 700; text-decoration: none;">Cancel</a>
                </p>
            </div>
        </div>
    </div>
</div>

<script>
    // Password Strength Meter
    const passwordInput = document.getElementById('new_password');
    const meterSegments = [
        document.getElementById('meter-segment-1'),
        document.getElementById('meter-segment-2'),
        document.getElementById('meter-segment-3'),
        document.getElementById('meter-segment-4')
    ];
    const feedbackText = document.getElementById('password-feedback');

    function checkPasswordStrength(password) {
        let strength = 0;

        if (password.length > 0) strength += 1;
        if (password.length >= 8) strength += 1;
        if (/(?=.*[a-z])(?=.*[A-Z])/.test(password)) strength += 1;
        if (/(?=.*\d)(?=.*[\W_])/.test(password)) strength += 1;

        return strength;
    }

    function updateMeter(strength) {
        const colors = ['transparent', '#ef4444', '#f59e0b', '#10b981', '#059669'];
        const labels = ['', 'Too weak', 'Fair', 'Good', 'Strong'];

        meterSegments.forEach((segment, index) => {
            if (index < strength) {
                segment.style.background = colors[strength];
            } else {
                segment.style.background = 'transparent';
            }
        });

        feedbackText.textContent = labels[strength];
        if (strength > 0) {
            feedbackText.style.color = colors[strength];
        } else {
            feedbackText.textContent = '';
        }
    }

    passwordInput.addEventListener('input', (e) => {
        const strength = checkPasswordStrength(e.target.value);
        updateMeter(strength);
    });

    // Force Light Mode
    document.body.classList.remove('dark-mode');
    document.body.style.background = '#ffffff';
    document.body.style.color = '#111827';
    localStorage.setItem('theme', 'light');
</script>
{% endblock %}